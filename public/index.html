<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Santi & Partner's Wedding</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Georgia", serif;
        line-height: 1.6;
        color: #333;
        /* background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); */
        background: blue;
        min-height: 100vh;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      .header {
        text-align: center;
        margin-bottom: 40px;
        padding: 40px 0;
        background: rgba(255, 255, 255, 0.9);
        border-radius: 15px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      }

      .header h1 {
        font-size: 3rem;
        color: #8b4513;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
      }

      .header p {
        font-size: 1.2rem;
        color: #666;
        font-style: italic;
      }

      .hero-image {
        width: 100%;
        max-width: 600px;
        height: 300px;
        object-fit: cover;
        border-radius: 10px;
        margin: 20px 0;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      }

      .section {
        background: rgba(255, 255, 255, 0.95);
        margin: 30px 0;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      }

      .section h2 {
        color: #8b4513;
        margin-bottom: 20px;
        font-size: 2rem;
        text-align: center;
      }

      .form-group {
        margin-bottom: 15px;
      }

      .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        color: #555;
      }

      .form-group input {
        width: 100%;
        padding: 12px;
        border: 2px solid #ddd;
        border-radius: 8px;
        font-size: 16px;
        transition: border-color 0.3s;
      }

      .form-group input:focus {
        outline: none;
        border-color: #8b4513;
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr 100px;
        gap: 15px;
        align-items: end;
      }

      .btn {
        background: linear-gradient(135deg, #8b4513, #a0522d);
        color: white;
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        font-weight: bold;
        transition: transform 0.2s, box-shadow 0.2s;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(139, 69, 19, 0.3);
      }

      .btn:active {
        transform: translateY(0);
      }

      .btn-send {
        background: linear-gradient(135deg, #2e8b57, #3cb371);
        width: 100%;
        padding: 15px;
        font-size: 18px;
        margin-top: 20px;
      }

      .table-container {
        overflow-x: auto;
        margin-top: 20px;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        background: white;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      th,
      td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #ddd;
      }

      th {
        background: linear-gradient(135deg, #8b4513, #a0522d);
        color: white;
        font-weight: bold;
      }

      tr:hover {
        background-color: #f5f5f5;
      }

      .loading {
        text-align: center;
        padding: 20px;
        color: #666;
      }

      .error {
        background: #ffebee;
        color: #c62828;
        padding: 10px;
        border-radius: 5px;
        margin: 10px 0;
      }

      .success {
        background: #e8f5e8;
        color: #2e7d32;
        padding: 10px;
        border-radius: 5px;
        margin: 10px 0;
      }

      @media (max-width: 768px) {
        .form-row {
          grid-template-columns: 1fr;
        }

        .header h1 {
          font-size: 2rem;
        }

        .container {
          padding: 10px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>ðŸ’• Santi & Partner ðŸ’•</h1>
        <p>Together Forever â€¢ June 15, 2024</p>
        <img
          src="/images/couple.jpg"
          alt="Santi & Partner"
          class="hero-image"
          onerror="this.style.display='none'"
        />
      </div>

      <div class="section">
        <h2>Guest Management</h2>
        <form id="guestForm">
          <div class="form-row">
            <div class="form-group">
              <label for="name">Guest Name</label>
              <input
                type="text"
                id="name"
                name="name"
                placeholder="Enter guest name"
                required
              />
            </div>
            <div class="form-group">
              <label for="email">Email Address</label>
              <input
                type="email"
                id="email"
                name="email"
                placeholder="Enter email address"
                required
              />
            </div>
            <div class="form-group">
              <label for="pluses">Plus Ones</label>
              <input
                type="number"
                id="pluses"
                name="pluses"
                min="0"
                value="0"
                placeholder="0"
              />
            </div>
          </div>
          <button type="submit" class="btn">Add Guest</button>
        </form>

        <div id="message"></div>

        <button id="sendInvites" class="btn btn-send">
          ðŸ“§ Send Invitations to All Guests
        </button>

        <div class="table-container">
          <table id="guestsTable">
            <thead>
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Plus Ones</th>
              </tr>
            </thead>
            <tbody id="guestsTableBody">
              <tr>
                <td colspan="3" class="loading">Loading guests...</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="section">
        <h2>Our Story</h2>
        <p style="text-align: center; font-size: 1.1rem; line-height: 1.8">
          We met in the most magical way and knew from the start that we were
          meant to be together. Now we're excited to celebrate our love with all
          of you on our special day!
        </p>
      </div>
    </div>

    <script>
      const guestsTableBody = document.querySelector("#guestsTableBody");
      const messageDiv = document.getElementById("message");

      const showMessage = (text, type = "success") => {
        messageDiv.innerHTML = `<div class="${type}">${text}</div>`;
        setTimeout(() => {
          messageDiv.innerHTML = "";
        }, 3000);
      };

      const refreshGuests = async () => {
        try {
          const response = await fetch("/api/guests");
          if (!response.ok) throw new Error("Failed to fetch guests");

          const guests = await response.json();

          if (guests.length === 0) {
            guestsTableBody.innerHTML =
              '<tr><td colspan="3" style="text-align: center; color: #666;">No guests added yet</td></tr>';
            return;
          }

          guestsTableBody.innerHTML = guests
            .map(
              (guest) =>
                `<tr>
                        <td>${guest.name || ""}</td>
                        <td>${guest.email}</td>
                        <td>${guest.pluses || 0}</td>
                    </tr>`
            )
            .join("");
        } catch (error) {
          console.error("Error loading guests:", error);
          guestsTableBody.innerHTML =
            '<tr><td colspan="3" class="error">Error loading guests. Please try again.</td></tr>';
        }
      };

      document
        .getElementById("guestForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          const formData = new FormData(e.target);
          const guestData = {
            name: formData.get("name"),
            email: formData.get("email"),
            pluses: Number(formData.get("pluses") || 0),
          };

          try {
            const response = await fetch("/api/guest", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(guestData),
            });

            if (!response.ok) {
              const errorText = await response.text();
              throw new Error(errorText);
            }

            showMessage("Guest added successfully!");
            e.target.reset();
            refreshGuests();
          } catch (error) {
            console.error("Error adding guest:", error);
            showMessage(`Error: ${error.message}`, "error");
          }
        });

      document
        .getElementById("sendInvites")
        .addEventListener("click", async () => {
          if (
            !confirm("Are you sure you want to send invitations to all guests?")
          ) {
            return;
          }

          const button = document.getElementById("sendInvites");
          const originalText = button.textContent;
          button.textContent = "Sending...";
          button.disabled = true;

          try {
            const response = await fetch("/api/send-invites", {
              method: "POST",
            });

            const result = await response.text();

            if (response.ok) {
              showMessage(result);
            } else {
              throw new Error(result);
            }
          } catch (error) {
            console.error("Error sending invites:", error);
            showMessage(`Error: ${error.message}`, "error");
          } finally {
            button.textContent = originalText;
            button.disabled = false;
          }
        });

      // Load guests on page load
      refreshGuests();
    </script>
  </body>
</html>
